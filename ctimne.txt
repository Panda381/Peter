Gemtree Petr 2.50 (pro Windows 95 a vyšší)
FREEWARE / PUBLIC DOMAIN

Autor: (c) 1997-2022 Miroslav Němeček
domovská stránka autora: http://panda38.sweb.cz
email autora: Panda38@seznam.cz
alternativní email: hardyplotter2@gmail.com


Autorská domovská stránka programu Petr: https://www.breatharian.eu/Petr
Oficiální stránky Petra (dnes již neudržované): http://www.gemtree.com a http://www.gemtree.cz
Programy a hry vytvořené v Petrovi: https://www.breatharian.eu/Petr/program
komunitní server: https://www.itnetwork.cz/pro-deti/petr
GitHub: https://github.com/Panda381/Peter


LICENCE
-------
Program Petr lze používat volně pro nekomerční i komerční účely.
Podobně volně lze používat a modifikovat zdrojové kódy programu Petr.
Ovšem nedoporučuji zdrojové kódy používat, protože na Petrovi jsem se
teprve učil programovat v C++ ;-) a mnoho věcí bych dnes už řešil
jinak.

Petr je nabízen k použití v takové formě, v jaké je, bez jakékoliv
další podpory a bez dalšího vývoje a oprav.


Doporučení
----------
Instalaci spustíte spuštěním Peter250.exe (nejlépe jako
Administrátor) nebo rozbalením ZIP bez instalátoru.
Pod Windows 10 doplňte ze složky Help ještě soubory:
Peter.exe, PETER_CZ.CHM a PETER_EN.CHM.


Poznámky
--------
- Pod některými systémy může být nefunkční instalace a odinstalace,
  v tom případě může být nutné použít verzi bez instalace.
  Příp. odinstalovat opětovným spuštěním instalátoru.
  Instalátor zpravidla funguje spuštěním pod Administrátorem.

- Některé antivirové programy mohou označovat mylně programy vytvořené
  v Petrovi jako obsahující virus (mallware). Důvodem je to, že Petr
  ukládá editovaný program přímo do EXE souboru. EXE soubor obsahuje
  interpreter a připojený program v binárním tvaru. Některé antiviry
  považují činnost interpreteru za projevy viru. Typicky se jedná
  o programy uložené v nespustitelném tvaru (bez interpreteru).

- Pod vyššími systémy nelze zobrazit nápovědu. Je nutné buď nainstalovat
  ze stránek Microsoft program WinHlp32.exe nebo přikopírovat do složky
  Petra z adresáře Help soubory Peter.exe, PETER_CZ.CHM a PETER_EN.CHM
  (jedná se o modifikaci Petra od uživatele Jiří Peroutka). Help v HTML
  formátu si můžete zobrazit též pomocí Help\HELP_CZ\index.html.

- Některé programy používají zvuky ve formátu MP3 (např. hlasy duchů
  ve hře "Třináct duchů"). Pokud zvuky nefungují, může být nutné
  nainstalovat MP3 kodek (program Misc\L3CODECX.EXE).


Verze s instalátorem
--------------------
Problémy s instalací: Při pokusu o odinstalování standardní cestou může systém
Windows XP (nebo vyšší) hlásit neplatnou aplikaci. V tom případě použijte
k odinstalování opět instalátor aplikace Petr (stačí mini verze a smazat
ručně instalační složku) nebo jen smažte ručně instalační složku Petra a
příslušné zástupce. K instalaci do systému Vista a vyšší bude možná nutné
použit verzi bez instalátoru (jen rozbalit) nebo alternativní instalátor
z komunitního serveru https://www.itnetwork.cz/pro-deti/petr .
Nebo zpravidla stačí spustit instalátor jako Administrátor.

Peter250.exe - Petr 2.50 plná instalace (400 MB)
https://www.breatharian.eu/Petr/download/Peter250.exe
Obsahuje: aplikaci Petr, helpy (český a anglický), asi 160 ukázkových
programů, 2400 obrázků, 1000 ikon (předmětů), 1500 zvuků, 560 hudeb,
400 sprajtů, zdroje pro generování sprajtů.

Peter250mini.exe - Petr 2.50 mini instalace (5 MB)
https://www.breatharian.eu/Petr/download/Peter250mini.exe
Obsahuje: aplikaci Petr, helpy (český a anglický), ukázkové programy
Bludiště a Tutorial, ukázkové knihovní soubory.

Peter241Lite.exe - Petr 2.41 Lite instalace (5 MB)
https://www.breatharian.eu/Petr/download/Peter241Lite.exe
Starší verze s omezenými funkcemi. Může být užitečná pro mladší nebo začínající
uživatele, protože neobsahuje žádné nebezpečné funkce (jako jsou např. souborové
a paměťové operace). Lze instalovat a používat spolu s verzí 2.50, protože
se instaluje do jiné složky.

Peter223LiteCZ.exe - Petr 2.23 Lite instalace (2,5 MB)
https://www.breatharian.eu/Petr/download/Peter223LiteCZ.exe
Ještě starší verze s ještě omezenějšími funkcemi. Help je pouze v češtině.

Popisky souborů (aliases) jsou v češtině, angličtině a němčině - v závislosti
na zvoleném jazyku. Jazyk při spuštění ukázkových programů závisí na jazyku
zvoleném v prostředí Petr (je-li spuštěný) nebo na jazyku systému.


Verze bez instalátoru
---------------------
Petr ke svému provozu nevyžaduje instalaci, postačí archivní soubor ZIP rozbalit
do instalační složky (k rozbalení použijte program WinZip nebo ještě lépe WinRar).
Není tak automaticky podporováno víceuživatelské prostředí, tj. při modifikaci
vzorového programu se program změní v instalační složce, ale to lze napravit
vytvořením zástupce, a nastavit "Spustit v" na pracovní složku uživatele a
"Cíl" na instalační složku Petra.

Peter250.zip - Petr 2.50 plný, ZIP bez instalace (370 MB)
https://www.breatharian.eu/Petr/download/Peter250.zip

Peter250mini.zip - Petr 2.50 mini, ZIP bez instalace (4 MB)
https://www.breatharian.eu/Petr/download/Peter250mini.zip

Peter241Lite.zip - Petr 2.41 Lite, ZIP bez instalace (4 MB)
https://www.breatharian.eu/Petr/download/Peter241Lite.zip

Peter223LiteCZ.zip - Petr 2.23 Lite, ZIP bez instalace, český help (1,8 MB)
https://www.breatharian.eu/Petr/download/Peter223LiteCZ.zip

Peter251_help.zip - Petr 2.51 help, ZIP bez instalace (6 MB)
https://www.breatharian.eu/Petr/download/Peter251help.zip
Modifikace programu Petr od uživatele Jiřího Peroutky, s helpem předělaným
do formátu CHM, pro systém Windows 10. Původní verze Petra používá help ve
formátu HLP, který byl staršími systémy podporován. Novější systémy Windows
formát HLP přestaly podporovat a je nutná doinstalace podpory HLP ze stránek
Microsoftu - program WinHlp32.exe. Namísto toho lze použít tuto nápovědu
ve formátu CHM. Lze ji spouštět buď přímo, nebo z prostředí Petra použitím
zmodifikované verze Petra 2.51.


Překlad
-------
Program Gemtree Petr jsem psal před 25 lety, kdy byl standardem operační systém
Windows 95 a displej s 256 paletovými barvami. Z toho vychází i funkčnost Petra.
Podporuje pouze grafiku 256 paletových barev (příp. v 3D grafice i omezeně
True-Color), některé funkce jsou už zastaralé a v novém prostředí problematické.
A teprve jsem se na Petrovi učil programovat v C++ a tak i vypadá kód. :-)
Mnohé věci bych dnes už udělal jinak.

Zdrojový kód Petra je poněkud problematické přeložit. (mimochodem, omlouvám se
cizincům - komentáře v kódu jsou pouze v českém jazyce) Vyžaduje k překladu
překladač Microsoft VC 6.0 a prostředí Windows 95 nebo Windows 98. Důvody:

1) Z překladu jsou vyloučeny standardní C knihovny, Petr si řeší vše sám
   (jako např. správce pro alokaci paměti). To ovšem vyžaduje, že kód používá
   určité obcházky aby se přizpůsobil překladači. Je proto velmi obtížné překlad
   přizpůsobit jinému překladači.

2) Obrázky v Petrovi jsou ve formátu komprimovaný BMP 256 barev s paletami.
   Displej musí být v módu 16-bitových barev. Obrázky jsou editované interním
   editorem MS VC++ 6.0. Pokud byl displej ve více barvách, obsah obrázků
   se ničil. A pokud se použil jiný systém než Windows 95-98, obrázky se
   neukládaly komprimovaně.

Zkoušel jsem program přeložit v aktuálním systému s aktuálním MS VC++, zřejmě by to
bylo možné, ale vyžadovalo by to změny:

- povolit linkování standardních C knihoven
- namísto vlastního správce používat standardní C knihovny (malloc)
- obrázky editovat externím editorem
- nepoužívat přepínání módu zaokrouhlování matematického koprocesoru (řešit jinak)
- zrušit inicializaci globálních objektů

Přeložit mi to sice nakonec šlo, ale nefungovalo - vyžadovalo by to ještě přepracování
modifikace EXE souborů. :-)

Jak překládat:

Před překladem spustit poveláky "Setup\Res\Source\!Konv.bat", který připraví obrázky
pro instalátor, a "HLP\Source\!Konv.bat", který připraví obrázky pro help. Používá se
DOS utilita alchemy.exe, proto je nutné mít dostatek DOS paměti, a je nutný systém Windows
max. XP, novější systémy už nepodporují DOS programy. Systém Windows 98 je možné u novějších
systémů provozovat pod emulátorem VirtualPC. Není-li už VirtualPC v systému podporován,
lze nejdříve emulovat ve VirtualBox systém Windows XP a v něm emulovat Windows 98 ve
VirtualPC.

Po konverzi obrázků se projekt otevře v MS VC 6.0. U všech projektů je nutné přeložit
všechny varianty Release. Jako první je nutné přeložit projekt DelExe, dále pak už lze
podle abecedy shora dolů (Loader musí být před Peter). Prostředí by mělo být Windows 98.
Při případných snahách rozběhnout překlad např. pod Windows XP bude nutné spouštět VC
v kompatibilním módu W98. Interní obrázky Petra se upravují interním editorem VC, Petr
je na jejich načítání připravený (ve formátu BMP 8 bitů s RLE). Při úpravě obrázku nesmí
být nastavený displej na true-color, musí být zvolený režim 16-bitových barev, jinak editor
poškodí barvy obrázku. Obrázky je nutné editovat pod W98 a ne pod NT a vyšší, protože ve
vyšších systémech se obrázky neukládají komprimovaně a programy jsou pak mnohem větší.
Upravíte-li obrázky jiným editorem, je nutné smazat soubory *.aps, aby překladač načetl
nový obrázek. Při změně čísla verze se verze opravuje v souborech: Main.h, Setup\Main.h,
HLP\Main_cz.rtf, HLP\Main_en.rtf, HLP\Peter_cz.hpj a HLP\Peter_en.hpj.

Složky v projektu:

DataInst je instalátor datových souborů (např. instalátor ukázkových programů), dnes
  se již nepoužívá.

DelExe je utilitka pro smazání instalátoru po odinstalování Petra.

Gener je utilitka pro zkompletování instalátoru Petra. Sestaví do balíku obsahy
  podadresářů (instalačních skupin): "0"=hlavní program s helpy, "1"=aplikace v Petrovi,
  "2"=knihovna předmětů, "3"=knihovna obrázků, "4"=knihovna sprajtů, "5"=knihovna zvuků,
  "6"=knihovna hudeb, "7"=ostatní knihovny, "8"=zdroje pro generování sprajtů. Soubor
  Peter.exe určuje datum a čas instalovaných souborů.

HLP je nápověda (překládá se z RTF souborů do HLP pomocí překladače HCW).

Loader je interpreter programu vytvořeného v Petrovi. Petr k němu (do záhlaví EXE)
  přidá sekci ".petprg", která obsahuje editovaný a prováděný program. Interpreter
  při startu program předpřeloží do pseudokódu, který se pak provádí - vytvoří
  struktury EXECITEM, jejichž součástí je adresa funkce, která se má pro příslušný
  prvek zavolat.

Loader0 je zjednodušený zavaděč, program neprovádí, slouží jen jako záhlaví programu
  pro možnost distribuce v nespustitelném tvaru (aby byl program menší).

Pov2Spr je konvertor obrázků na sprajty.

Setup je instalátor Petra.
